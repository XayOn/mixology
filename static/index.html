<html>
  <head>
    <link rel=stylesheet href="/static/bootstrap.min.css" />
    <script src="https://unpkg.com/axios@0.2.1/dist/axios.js"></script>
    <script>
	async function loadRecipes(values){
          // Don't judge me. I wanted it as a multi-value query param and...
	  let vals = ""; for (const v of values) { vals += `current=${v}&`};
          return await axios.get(`/recipes/?${vals}`)
	}
	async function loadAlcohols() {
	  const cont = document.getElementById('alcohols');
	  cont.innerHTML = "" 
	  const alc = await axios.get(`/alcohols`);
          alc.forEach(name => cont.innerHTML += `<label><input name=alcohols \
		        		         type=checkbox value='${name}'/>${name}</label>`);
	}
	async function prepare(recipe){
	  return await axios.post('/recipes/', json=recipe)
	}
	async function build(){
          document.getElementById('cocktails').innerHTML = '';
	  const cboxes = document.querySelectorAll('input[name=alcohols]:checked');
	  let values = []; cboxes.forEach(function(cbox){ values.push(cbox.value); })
	  window.recipes = await loadRecipes(values)
	  window.recipes.forEach(function(recipe, pos) {
            document.getElementById('cocktails').innerHTML += recipe.repr;
	    document.getElementById('cocktails').innerHTML += `<button onclick='prepare(window.recipes[${pos}])' value="Prepare">Prepare</button>`
	  })
	}

	window.onload = loadAlcohols;

    </script>
  </head>
  <body>
    <div id=alcohols></div>
    <input type="button" onclick="build()" value="Get recipes">
    <div id=cocktails></div>
  </body>
</html>
